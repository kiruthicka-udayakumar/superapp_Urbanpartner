<!DOCTYPE html>
<html>

<head>
    <title>Login Flow Test</title>
</head>

<body>
    <h1>Login Flow Test</h1>
    <p>Open Console (F12) to see results</p>
    <button onclick="testLoginFlow()">Test Login Flow</button>

    <script>
        const testLoginFlow = async () => {
            const phoneNumber = '+919876543210';
            const otp = '513567';

            console.log('='.repeat(60));
            console.log('TESTING FRONTEND LOGIN FLOW');
            console.log('='.repeat(60));

            try {
                // Simulate what authService.verifyOTP does
                const response = await fetch('http://localhost:5000/api/auth/partner/verify-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phoneNumber, otp })
                });

                const data = await response.json();

                console.log('\n1. API Response:');
                console.log(JSON.stringify(data, null, 2));

                console.log('\n2. Checking response structure:');
                console.log('   - data.success:', data.success);
                console.log('   - data.token exists:', !!data.token);
                console.log('   - data.token type:', typeof data.token);

                console.log('\n3. Attempting localStorage.setItem:');
                if (data.token) {
                    localStorage.setItem('partnerToken', data.token);
                    console.log('   ✅ Token stored');

                    const stored = localStorage.getItem('partnerToken');
                    console.log('   - Verification:', stored ? 'Token found in localStorage' : 'Token NOT in localStorage');
                    console.log('   - Token length:', stored ? stored.length : 0);
                } else {
                    console.log('   ❌ No token in response!');
                }

                console.log('\n4. Final check:');
                const finalToken = localStorage.getItem('partnerToken');
                console.log('   localStorage.getItem("partnerToken"):', finalToken ? 'PRESENT (' + finalToken.substring(0, 20) + '...)' : 'NULL');

                if (finalToken) {
                    console.log('\n✅ SUCCESS! Token is stored. Redirecting to dashboard...');
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 2000);
                } else {
                    console.log('\n❌ FAILED! Token not stored.');
                }

            } catch (error) {
                console.error('ERROR:', error);
            }

            console.log('='.repeat(60));
        };

        // Auto-run on page load
        window.addEventListener('load', testLoginFlow);
    </script>
</body>

</html>